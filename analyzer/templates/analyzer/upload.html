{% extends "base.html" %}
{% load static %}
{% block content %}


<style>

  .job-meta input[type="text"]{ height:42px; }

  @media (min-width: 992px){
    .job-meta{
      padding-left:1.25rem;
      border-left:1px solid var(--border);
      max-width:460px;
      min-width:360px;
    }
  }

  .btn-action{ border-radius:999px; padding:.7rem 1.4rem; font-weight:600; letter-spacing:.01em; }
  .btn-clear{ border-color:var(--border-strong); color:#374151; background:#fff; }
  .btn-clear:hover{ background:#f9fafb; border-color:#cbd5e1; }
  .btn-analyze{ background:var(--brand); border-color:var(--brand); box-shadow:0 6px 16px rgba(13,110,253,.18); }
  .btn-analyze:hover{ filter:brightness(.96); box-shadow:0 8px 22px rgba(13,110,253,.22); }
  .btn-analyze:disabled{ opacity:.85; box-shadow:none; }
</style>

<header class="mb-4">
  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3">

    <div class="flex-grow-1">
      <h1 class="fw-bold mb-1">Compare CV to Job Ad</h1>
      <p class="text-muted mb-0">Upload files or paste text to analyze skill match.</p>
    </div>

    <div class="job-meta w-100 w-lg-auto">
      <div class="row g-2">
        <div class="col-12 col-lg-6">
          <label for="{{ form.job_title.id_for_label }}" class="form-label mb-1">Job Title</label>
          {{ form.job_title }}
        </div>
        <div class="col-12 col-lg-6">
          <label for="{{ form.company.id_for_label }}" class="form-label mb-1">Company</label>
          {{ form.company }}
        </div>
      </div>
    </div>
  </div>
</header>

<form method="post" enctype="multipart/form-data" id="uploadForm" class="upload-flat">
  {% csrf_token %}

  <div class="upload-wrapper card border-0 shadow-sm">
    <div class="upload-inner position-relative">
      <div class="v-divider d-none d-lg-block" aria-hidden="true"></div>

      <div class="row g-0">
        <section class="col-12 col-lg-6 half px-3 px-lg-4 py-4">
          <h5 class="section-title">CV</h5>

          <div class="mb-3">
            <label for="{{ form.cv.id_for_label }}" class="form-label">Upload file</label>
            {{ form.cv }}
            <div class="helper">PDF, DOCX, TXT · Max 10MB</div>
          </div>

          <div class="or-pill my-3"><span>OR</span></div>

          <div class="mb-2">
            <label for="{{ form.cv_text.id_for_label }}" class="form-label">Paste text</label>
            <div class="textarea-wrap">
              {{ form.cv_text }}
            </div>
          </div>
          <div class="helper">PDF, DOCX, TXT · Max 10MB</div>
        </section>


        <section class="col-12 col-lg-6 half px-3 px-lg-4 py-4">
          <div class="d-flex align-items-center justify-content-between">
            <h5 class="section-title mb-0">Job Ad</h5>
            {% if form.job_title.value or form.company.value %}
              <small class="text-muted ms-2 text-truncate" style="max-width:60%;">
                Comparing to:
                {% if form.job_title.value %}<strong>{{ form.job_title.value }}</strong>{% endif %}
                {% if form.company.value %} @ <strong>{{ form.company.value }}</strong>{% endif %}
              </small>
            {% endif %}
          </div>

          <div class="mb-3 mt-2">
            <label for="{{ form.jd.id_for_label }}" class="form-label">Upload file</label>
            {{ form.jd }}
            <div class="helper">PDF, DOCX, TXT · Max 10MB</div>
          </div>

          <div class="or-pill my-3"><span>OR</span></div>

          <div class="mb-2">
            <label for="{{ form.jd_text.id_for_label }}" class="form-label">Paste text</label>
            <div class="textarea-wrap">
              {{ form.jd_text }}
            </div>
          </div>
          <div class="helper">PDF, DOCX, TXT · Max 10MB</div>
        </section>
      </div>
    </div>
  </div>

  <div class="action-bar mt-4">
    <div class="d-flex flex-column flex-md-row align-items-stretch align-items-md-center justify-content-between gap-3">
      <div class="text-muted small">
        Files are processed securely. You can delete results anytime.
      </div>
      <div class="d-flex gap-2">
        <button type="reset" class="btn btn-outline-secondary btn-clear btn-action">Clear</button>
        <button type="submit" class="btn btn-primary btn-analyze btn-action" id="analyzeBtn">
          <span class="btn-label">Analyze</span>
          <span class="btn-loading d-none d-inline-flex align-items-center gap-2">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span>Analyzing…</span>
          </span>
        </button>
      </div>
    </div>
  </div>
</form>

{% if uploaded %}
  <div class="alert alert-success alert-dismissible fade show d-flex align-items-center gap-2 mt-4" role="alert">
    <div>Received: <strong>{{ cv_name }}</strong> and <strong>{{ jd_name }}</strong></div>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
{% endif %}

<script>
  (function () {
    const form = document.getElementById('uploadForm');
    const btn  = document.getElementById('analyzeBtn');
    form.addEventListener('submit', function () {
      btn.disabled = true;
      btn.querySelector('.btn-label').classList.add('d-none');
      btn.querySelector('.btn-loading').classList.remove('d-none');
    });
  })();
</script>

{% endblock %}